## Linux文件系统

### 基本的Linux文件系统



#### ext文件系统

​	Linux操作系统引入的最早的文件系统叫做拓展文件系统(Extended filesystem, 简称为ext)。ext为Linux提供了一个基本的类Unix文件系统。**ext使用虚拟目录来操作硬件设备，在物理设备上按定长的块的存储数据**。

​	**ext文件系统采用名为索引节点(inode)的系统来存放虚拟目录中所存储文件的信息**。**索引节点系统在每个物理设备中采用一个单独的表(称为索引节点表)来存储这些文件的信息**。存储在虚拟目录中的每个文件在索引节点表中都有一个条目。**ext文件系统名称中的extended部分来自其跟踪的每个文件的额外数据**，包括:

- 文件名

- 文件大小

- 文件的宿主

- 文件的属组

- 文件的访问权限

- 指向存有文件数据的每个硬盘块的指针

  **Linux通过唯一的数值(索引节点号)来引用索引节点表中的每个索引节点，这个值是创建文件时由文件系统分配的**。文件系统通过索引节点号而不是文件全名及路径来标识文件。



#### ext2文件系统

​	最早的ext文件系统有不少限制，比如文件大小不得超过2G。在Linux出现后不久，ext文件就升级到了第二代拓展文件系统，称为ext2。

​	ext2文件系统拓展了索引节点表的格式来保存系统上每个文件的更多信息。

​	ext2的索引节点表为文件添加了创建时间值、修改时间值、最后访问时间值来帮助系统管理员追踪文件的访问情况。ext2文件系统还将允许的最大文件大小增加到了2TB。

​	除了拓展索引节点表之外，ext2文件系统还改变了文件在数据块中存储的方式。ext文件系统常见的问题是在文件写入到物理设备时，存储数据用的块很容易分散在整个设备中(称作碎片化)。数据块的碎片会降低文件系统的性能，因为需要更长的时间再存储设备中查找特定文件的所有块。

​		**ext2文件系统通过按组分配磁盘块来减轻碎片化**。通过**将数据块分组，文件系统在读取文件时不需要为了数据块查找整个物理设备。**

​	但是ext2文件系统也有它的缺点：索引节点表虽然支持文件系统保存有关文件的更多信息，但是会对系统造成致命的问题。**ext2文件系统每次存储或更新文件，它都要用新信息来更新索引节点表**。问题在于：**如果计算机系统在存储文件和更新索引节点表之间发生了异常，就会导致这二者的内容不一致了，这样很容易导致文件的崩溃**。

#### 日志文件系统

​	日志文件系统为Linux系统增加了一层安全性。**日志文件系统不再使用之前先将数据直接写入存储设备再更新索引节点表的做法，而是先将文件的更改写入到临时文件(称作日志，journal)中**。**在数据成功写到存储设备和索引节点表之后，在删除对应的日志条目**。

​	如果系统在数据写入存储设备之前崩溃或断电了，日志文件系统下次会读取日志文件并处理上次留下的未写入的数据。



#### 写时复制文件系统

​	采用了日志技术，就必须在安全性和性能之间做出选择。尽管数据模式日志提高了最高的安全性，但是会对性能造成影响，因为索引节点和数据都需要被日志化。如果是回写模式日志，性能倒是可以接受，但是安全性就会遭到损坏。

​	就文件系统而言，日志式的另一种选择叫**写时复制技术**(copy-on-write, COW)。COW利用快照兼顾了安全性和性能。如果要修改数据，会使用克隆或可写快照。修改过的数据并不会直接覆盖当前数据，而是被放到文件系统的另一个位置上。即便是数据修改已经完成，之前的旧数据也不会被重写。

​	